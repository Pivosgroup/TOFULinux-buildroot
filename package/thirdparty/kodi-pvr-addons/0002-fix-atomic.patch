--- a/lib/cppmyth/cppmyth/src/atomic.h	2015-04-07 02:49:07.000000000 +1000
+++ b/lib/cppmyth/cppmyth/src/atomic.h	2015-07-13 20:11:58.561079890 +1000
@@ -88,7 +88,7 @@
 #elif defined __APPLE__
   __val = OSAtomicIncrement32(valp);
 
-#elif defined ANDROID
+#elif defined ANDROID || (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 7))
   __val = __sync_add_and_fetch(valp, 1);
 
 #elif defined __mips__
@@ -148,14 +148,14 @@
 #elif (defined __ARM_ARCH && __ARM_ARCH >= 7)
   int inc = 1;
   __asm__ volatile (
-    "dmb     ish\n"           /* Memory barrier */
+    "dmb\n"           /* Memory barrier */
     "1:"
     "ldrex   %0, [%1]\n"
     "add     %0, %0,  %2\n"
     "strex   r1, %0, [%1]\n"
     "cmp     r1, #0\n"
     "bne     1b\n"
-    "dmb     ish\n"           /* Memory barrier */
+    "dmb\n"           /* Memory barrier */
     : "=&r" (__val)
     : "r"(valp), "r"(inc)
     : "r1");
@@ -224,7 +224,7 @@
 #elif defined __APPLE__
   __val = OSAtomicDecrement32(valp);
 
-#elif defined ANDROID
+#elif defined ANDROID || (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 7))
   __val = __sync_sub_and_fetch(valp, 1);
 
 #elif defined __mips__
@@ -285,13 +285,13 @@
   int dec = 1;
   __asm__ volatile (
     "1:"
-    "dmb     ish\n"           /* Memory barrier */
+    "dmb\n"           /* Memory barrier */
     "ldrex   %0, [%1]\n"
     "sub     %0, %0,  %2\n"
     "strex   r1, %0, [%1]\n"
     "cmp     r1, #0\n"
     "bne     1b\n"
-    "dmb     ish\n"           /* Memory barrier */
+    "dmb\n"           /* Memory barrier */
     : "=&r" (__val)
     : "r"(valp), "r"(dec)
     : "r1");
